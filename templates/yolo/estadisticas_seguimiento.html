<h2>Estadísticas de Seguimiento Vehicular</h2>
<p><a href="/">Inicio</a> | <a href="/accounts/logout/">Cerrar sesión</a></p>

<h3>Tabla de Seguimientos Recientes</h3>
<table border="1">
  <tr>
    <th>Fecha y Hora</th>
    <th>Velocidad Detectada (km/h)</th>
    <th>ID Vehículo</th>
    <th>ID Cámara</th>
  </tr>
  {% for reg in datos %}
  <tr>
    <td>{{ reg.fecha_hora }}</td>
    <td>{{ reg.velocidad_detectada }}</td>
    <td>{{ reg.vehiculo_id }}</td>
    <td>{{ reg.camara_id }}</td>
  </tr>
  {% endfor %}
</table>

<hr>

<h3>Gráfico: Velocidades Detectadas</h3>
<canvas id="graficoVelocidades" width="100%" height="40"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('graficoVelocidades').getContext('2d');

  const labels = [
    {% for reg in datos reversed %}
      "{{ reg.fecha_hora|date:'H:i' }}",
    {% endfor %}
  ];

  const data = {
    labels: labels,
    datasets: [{
      label: 'Velocidad (km/h)',
      data: [
        {% for reg in datos reversed %}
          {{ reg.velocidad_detectada }},
        {% endfor %}
      ],
      borderColor: 'rgba(255, 99, 132, 1)',
      backgroundColor: 'rgba(255, 99, 132, 0.2)',
      fill: true,
      tension: 0.2
    }]
  };

  new Chart(ctx, {
    type: 'line',
    data: data,
    options: {
      responsive: true,
      scales: {
        x: {
          title: { display: true, text: 'Hora' }
        },
        y: {
          beginAtZero: true,
          title: { display: true, text: 'Velocidad (km/h)' }
        }
      }
    }
  });
</script>