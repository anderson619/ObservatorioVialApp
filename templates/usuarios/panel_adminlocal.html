<h2>Panel de Administrador Local</h2>
<p>Bienvenido, {{ request.user.username }}</p>
<p><a href="/">Inicio</a> | <a href="/accounts/logout/">Cerrar sesión</a></p>

<hr>

<h3>Cámaras de Seguridad</h3>
<p><a href="/adminlocal/camaras/nueva/">➕ Crear nueva cámara</a></p>
<ul>
  {% for camara in camaras %}
    <li>
      <strong>{{ camara.ubicacion }}</strong> — Estado: {{ camara.estado }}<br>
      Lat: {{ camara.latitud }}, Lon: {{ camara.longitud }}<br>
      IA: {{ camara.modelo_ia }}<br>
      <a href="/adminlocal/camaras/editar/{{ camara.id }}/">✏️ Editar</a> |
      <a href="/adminlocal/camaras/eliminar/{{ camara.id }}/" onclick="return confirm('¿Eliminar esta cámara?');">🗑️ Eliminar</a>
    </li>
  {% empty %}
    <li>No hay cámaras registradas.</li>
  {% endfor %}
</ul>

<hr>

<h3>Zonas Críticas</h3>
<p><a href="/adminlocal/zonas/nueva/">➕ Crear nueva zona crítica</a></p>
<ul>
  {% for zona in zonas %}
    <li>
      <strong>{{ zona.nombre_zona }}</strong> — {{ zona.tipo_problema }}<br>
      {{ zona.descripcion }}<br>
      Lat: {{ zona.latitud }}, Lon: {{ zona.longitud }}<br>
      <a href="/adminlocal/zonas/editar/{{ zona.id }}/">✏️ Editar</a> |
      <a href="/adminlocal/zonas/eliminar/{{ zona.id }}/" onclick="return confirm('¿Eliminar esta zona crítica?');">🗑️ Eliminar</a>
    </li>
  {% empty %}
    <li>No hay zonas críticas registradas.</li>
  {% endfor %}
</ul>

<hr>
<h3>Mapa de Cámaras y Zonas Críticas</h3>
<div id="map" style="height: 500px;"></div>

<!-- Leaflet CSS y JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([1.2136, -77.2811], 13);  // Punto de enfoque

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '© OpenStreetMap'
  }).addTo(map);

  // Cámaras
  {% for cam in camaras %}
    L.marker([{{ cam.latitud }}, {{ cam.longitud }}])
      .addTo(map)
      .bindPopup(<b>Cámara:</b> {{ cam.ubicacion }}<br><b>Estado:</b> {{ cam.estado }}<br><b>IA:</b> {{ cam.modelo_ia }});
  {% endfor %}

  // Zonas Críticas
  {% for zona in zonas %}
    L.circleMarker([{{ zona.latitud }}, {{ zona.longitud }}], {
      radius: 8,
      color: 'red',
      fillOpacity: 0.6
    }).addTo(map)
      .bindPopup(<b>Zona Crítica:</b> {{ zona.nombre_zona }}<br><b>Tipo:</b> {{ zona.tipo_problema }}<br>{{ zona.descripcion }});
  {% endfor %}
</script>