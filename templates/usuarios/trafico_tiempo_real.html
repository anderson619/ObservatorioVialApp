<h2>Tráfico en Tiempo Real</h2>
<p><a href="/">Inicio</a> | <a href="/accounts/logout/">Cerrar sesión</a></p>

<h3>Tabla de registros recientes</h3>
<table border="1">
    <tr>
        <th>Fecha y Hora</th>
        <th>Nivel de Congestión</th>
        <th>Cantidad de Vehículos</th>
        <th>Latitud</th>
        <th>Longitud</th>
    </tr>
    {% for registro in datos %}
    <tr>
        <td>{{ registro.fecha_hora }}</td>
        <td>{{ registro.nivel_congestion }}</td>
        <td>{{ registro.cantidad_vehiculos }}</td>
        <td>{{ registro.latitud }}</td>
        <td>{{ registro.longitud }}</td>
    </tr>
    {% endfor %}
</table>

<hr>

<h3>Gráfico: Cantidad de Vehículos</h3>
<canvas id="graficoTráfico" width="100%" height="40"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('graficoTráfico').getContext('2d');

  const labels = [
    {% for registro in datos reversed %}
      "{{ registro.fecha_hora|date:'H:i' }}",
    {% endfor %}
  ];

  const data = {
    labels: labels,
    datasets: [{
      label: 'Cantidad de Vehículos',
      data: [
        {% for registro in datos reversed %}
          {{ registro.cantidad_vehiculos }},
        {% endfor %}
      ],
      borderColor: 'rgba(75, 192, 192, 1)',
      backgroundColor: 'rgba(75, 192, 192, 0.2)',
      fill: true,
      tension: 0.2
    }]
  };

  new Chart(ctx, {
    type: 'line',
    data: data,
    options: {
      responsive: true,
      scales: {
        x: {
          title: { display: true, text: 'Hora' }
        },
        y: {
          beginAtZero: true,
          title: { display: true, text: 'Vehículos' }
        }
      }
    }
  });
</script>